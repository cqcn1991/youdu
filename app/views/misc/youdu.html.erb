

<nav class="navbar navbar-default">

  <div class="container-fluid">
    <div class="navbar-header">
      <h1>豆瓣友读</h1>
    </div>
  </div>
</nav>


<div >
    <div class="books">
      <div class="book ">
        <div class="row">
          <div class="book-cover col-md-3">
            <a class="nbg" href="https://img3.doubanio.com/lpic/s29215340.jpg" title="A Man for All Markets">
              <img src="https://img3.doubanio.com/lpic/s29215340.jpg" alt="A Man for All Markets" class="img-responsive" >
            </a>
          </div>
          <div class="book-info col-md-9">
            <h3 class="book-title">A Man for All Markets</h3>
            <div class="rating-info">
              <span class="rating">8.8 </span>
              <span class="rating-right text-info">★★★★★ <small>19人评价</small></span>
            </div>
            <div class="category">
              投资 / 金融 / 传记
            </div>

            <% @reviews.each do |review| %>
              <div class="review">
              <span class="user">
                <a href=""><%= review[:user] %></a>:
                <%= review[:content] %>
              </span>
              <span class="likes pull-right">
                <small>
                  <a href=""><%= fa_icon "thumbs-o-up" %></a> <%= review[:likes] %>
                </small>
              </span>
                </div>
            <% end %>
            <div class="review">
              <span class="user">
                <a href="">子珂</a>: 半本好书，前面挺有意思，讲他如何少年时的读书生涯，如何在几个专业间流转，如何解出21点，如何成为最早的quant并建立自己的hedge fund。可惜后面部分行文太过随意，没什么有深度的东西了
              </span>
              <span class="likes pull-right">
                <small>
                  <a href=""><%= fa_icon "thumbs-o-up" %></a> 62
                </small>
              </span>
            </div>

            <div class="borrow-info">
              <img alt="Hong是房东。" src="https://z2.muscache.com/im/pictures/5ccd7883-d4ab-4420-8e32-a5c6af9358f9.jpg?aki_policy=profile_x_medium" title="Hong的用户个人资料"
                   class="img-round pull-left avatar"
                   data-reactid="118" height="64" width="64">
              <div class="btn-group pull-right" >
                <button type="button" class="btn btn-primary btn-lg">借</button>
                <button type="button" class="btn btn-default btn-lg">在线试读</button>
              </div>
              <h4>
                Hong 等4人也有这本书
                <br>
                <small>25人借过</small>
              </h4>
            </div>
          </div>
        </div>



      </div>

      <% @books.each do |book|  %>
          <div class="book ">
            <div class="row">
              <div class="book-cover col-md-3">
                <a >
                  <%= image_tag(book[:cover], class:"img-responsive" ) %>
                </a>
              </div>
              <div class="book-info col-md-9">
                <h3 class="book-title"><%= book[:title] %></h3>
                <div class="rating-info">
                  <span class="rating"><%= book[:rating] %> </span>
                  <span class="rating-right text-info">★★★★★
                    <small><%= book[:ratings_num] %>人评价</small></span>
                </div>
                <div class="category">
                  <%= book[:category] %>
                  <!--投资 / 金融 / 传记-->
                </div>

                <% book[:reviews].each do |review| %>
                    <div class="review">
                        <span class="user">
                          <a href=""><%= review[:user] %></a>:
                          <%= review[:content] %>
                        </span>
                        <span class="likes pull-right">
                          <small>
                            <a href=""><%= fa_icon "thumbs-o-up" %></a> <%= review[:likes] %>
                          </small>
                        </span>
                    </div>
                <% end %>
                <div class="borrow-info">
                  <% if book[:borrow_info][:avaiable]  %>
                    <div class="btn-group pull-right" >
                      <button type="button" class="btn btn-primary btn-lg">借</button>
                      <button type="button" class="btn btn-default btn-lg">在线试读</button>
                    </div>
                    <% borrower = book[:borrow_info][:borrower]  %>
                    <%= image_tag(borrower[:avatar], class: 'img-round pull-left avatar' ) %>
                    <h4>
                      <%= borrower[:user_name] %> 有这本书
                      <br>
                      <small>附近<%= borrower[:distance] %>m, <%= borrower[:record_num] %>人借过</small>
                    </h4>
                  <% else  %>
                      <img src="https://z2.muscache.com/im/pictures/6b67c96e-02be-4c2d-965d-11ccb8b74873.jpg?aki_policy=profile_x_medium"
                           class="img-round pull-left avatar requester"
                           data-reactid="118" height="64" width="64">
                      <img src="https://z2.muscache.com/im/pictures/ad421b88-89a4-46be-99ba-22c5f60a3f84.jpg?aki_policy=profile_x_medium"
                           class="img-round pull-left avatar requester"
                           data-reactid="118" height="64" width="64">
                      <img src="https://z1.muscache.com/im/users/39563133/profile_pic/1437891275/original.jpg?aki_policy=profile_x_medium"
                           class="img-round pull-left avatar requester"
                           data-reactid="118" height="64" width="64">
                      <div class="btn-group pull-right" >
                        <button type="button" class="btn btn-success btn-lg">我有</button>
                        <button type="button" class="btn btn-default btn-lg">+1</button>
                      </div>
                      <h4>
                        猴子 等4人都想读
                        <br>
                        <small>附近2km</small>
                      </h4>


                  <% end  %>
                </div>
              </div>
            </div>



          </div>

    <% end  %>
    </div>

    <div class="map">
      <div id="mapid"></div>
      <script >
        var mymap = L.map('mapid').setView([51.505, -0.09], 13);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
          maxZoom: 18,
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
          '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
          'Imagery © <a href="http://mapbox.com">Mapbox</a>',
          id: 'mapbox.streets'
        }).addTo(mymap);

        var marker = L.marker([51.5, -0.09]).addTo(mymap);
      </script>

    </div>
</div>